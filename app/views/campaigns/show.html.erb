<style>
	.hero_background {
		background: <%= @campaign.hero %>;
		background-repeat: no-repeat;
		background-size: cover;
		background-position: 50% 50%;
	}
</style>

<script>
var ready;
var currentProgress = <%= @campaign.referrals.count %>;
function getProgress() {
  var goal = <%= @campaign.goal %>;
  var increment = $('#progress').width()/goal;
  var countdown = new Countdown({
      selector: '#countdown',
      msgPattern: "<div class='time_section'>{days}<br /> DAYS</div> <div class='time_section'>{hours}<br /> HOURS</div> <div class='time_section'>{minutes}<br /> MINUTES</div>",
      dateStart: new Date(),
      dateEnd: new Date("<%= @campaign.expiry.to_time %>")
  });
  $('#bar').css('right', function() {
    return $('#progress').width() - (increment*currentProgress) + "px";
  })
  $('#progress p').html(currentProgress);
}
ready = function() {
	getProgress();
	$(document).ajaxSuccess(function(event, request) {
	  var msg = JSON.parse(request.responseText);
	  if (msg) {
	  	$.gritter.add({ title: 'Success', text: msg.status });
	    currentProgress++;
	  	getProgress();
	  	$('#new_referral')[0].reset();
	  }
	});
}

$(document).ready(ready)
$(document).on('page:load', ready)
</script>

<div id='campaign_hero'>
	<div class='hero_background'></div>
	<div class='container clearfix'>
		<div class='campaign_media'>
			<%= @campaign.chosen_media %>
		</div>
		<div class='hero_details'>
			<h1><%= @campaign.title %></h1>
			<span class='hero_bold'>GOAL</span>
			<p class='hero_referrals'>
				<span><%= @campaign.goal %> Referrals</span>
			</p>
			<span class='hero_bold'>COUNTDOWN</span>
			<p id='countdown'></p>
		</div>
	</div>
</div>

<div class='container'>
	<div class='campaign_content'>
		<p><%= @campaign.details.html_safe %></p>
	</div>
	<% if @campaign.contact == current_contact %>
		<%= link_to "Edit Campaign", edit_campaign_path(@campaign) %>
	<% end %>
	<div class='campaign_meta'>
		<span class='content_bold'>GOAL</span>
		<div id='progress'>
			<div id='bar' data-value='<%= @campaign.referrals.count %>'></div>
			<p><%= @campaign.referrals.count %></p>
		</div>
		<span class='content_bold'>SHARE</span>
		<div class='content_share'>
		<a target="_blank" href='http://www.facebook.com/sharer/sharer.php?u=<%=u campaign_url(@campaign) %>&t=<%= @campaign.title %>'><i class='fa fa-facebook-square'></i></a>
		<a target="_blank" href='http://www.linkedin.com/shareArticle?mini=true&url=<%= campaign_url(@campaign) %>&title=<%= @campaign.title %>&source=leadstarter.influitive.com'><i class='fa fa-linkedin-square'></i></a>
		<a target="_blank" href='http://twitter.com/intent/tweet?status=<%= @campaign.title %>+<%= campaign_url(@campaign) %>'><i class='fa fa-twitter-square'></i></a>
<!-- 		<a target="_blank" href='#'><i class='fa fa-envelope-square'></i></a>
		<a target="_blank" href='#'><i class='fa fa-link'></i></a> -->
		</div>
		<% unless @campaign.expiry.past? %>
			<div class='campaign_refs'>
				<span class='ref_banner'> Please Submit Your Referral Details Below </span>
				<%= form_for [@campaign, Referral.new], remote: true do |f| %>
					<%= f.hidden_field :campaign_id, :value => @campaign.id %>
					<div class="field">
						<%= f.label :first_name %><br />
					    <%= f.text_field :first_name %>
					</div>

					<div class="field">
						<%= f.label :last_name %><br />
					    <%= f.text_field :last_name %>
					</div>

					<div class="field">
						<%= f.label :email %><br />
					    <%= f.text_field :email %>
					</div>

					<div class="field">
						<%= f.label :company %><br />
					    <%= f.text_field :company %>
					</div>

					<div class="field">
						<%= f.label :note %><br />
					    <%= f.text_field :note %>
					</div>	

					<div class="field">
						<%= f.label "Your Name" %><br />
					    <%= f.text_field :referree_name %>
					</div>

					<div class="field">
						<%= f.label "Your Email" %><br />
					    <%= f.text_field :referree_email %>
					</div>

					<div class="actions">
					  <%= f.submit "Submit Referral" %>
					</div>
				<% end %>
			</div>
		<% end %>
		<% if @campaign.rewards.any? %>
			<span class='content_bold'> REWARDS </span>
			<% @campaign.rewards.each do |r| %>
				<div class="campaign_reward clearfix">
					<span class="reward_milestone"><%= r.milestone %></span>
					<span class='table'><%= r.description.html_safe %></span>
				</div>
			<% end %>
		<% end %>
	</div>
</div>